### 用户故事：

##### 新增

选择核算部门、公司、勾选应付明细后，自动生成批量付款对应的单头和明细。
单头包括：自动生成唯一单号、当前日期为单据日期、应付上核算部门信息、公司信息、状态为待提交
明细包括：应付付款计划明细Id，付款金额
并插入到批量付款对应的单头和明细表。

查询条件：
公司、供应商、应付单号

保存后：
应付表、应付明细表数据和批量付款单的数据进行关联，并根据应付表上的供应商自动生成对应的批量付款供应商表记录

###### 删除

选中批量付款单头列表中待提交状态的记录，然后进行删除操作

##### 编辑

选中批量付款单头列表中待提交状态的记录，进行编辑操作，自动带入单头上的核算部门、公司信息，其它操作同新增

保存后：应付表、应付明细表数据和批量付款单的数据进行关联更新，并根据应付表上的供应商自动生成对应的批量付款供应商表记录

## 三、数据模型

### 3.1 批量付款单表（PaymentAutoItem）

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| Id | Guid | 主键 | 自动生成 |
| Code | string | 批量付款单号 | PAY202512150001 |
| BillDate | DateTime | 单据日期 | 2025-12-15 |
| CompanyId | Guid | 公司ID | - |
| CompanyName | string | 公司名称 | 总部公司 |
| CompanyCode | string | 公司编码 | C001 |
| DepartmentIdPath | string | 部门ID路径 | 01/0101 |
| DepartmentNamePath | string | 部门名称路径 | 总部/财务部 |
| DepartmentCurrentId | string | 当前部门ID | 0101 |
| Status | int | 状态 | 0-待提交/1-审批中/2-已完成/11-已驳回 |
| TotalAmount | decimal | 总金额 | 80000.00 |
| Remark | string | 备注 | 2025年1月批量付款 |
| AttachmentIds | string | 附件ID列表 | - |
| OARequestId | string | OA审批单ID | - |
| IsDeleted | bool | 是否删除 | false |
| CreatedAt | DateTime | 创建时间 | - |
| CreatedBy | string | 创建人 | - |
| UpdatedAt | DateTime | 更新时间 | - |
| UpdatedBy | string | 更新人 | - |

### 3.2 批量付款明细表（PaymentAutoDetail）

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| Id | Guid | 主键 | 自动生成 |
| PaymentAutoItemId | Guid | 批量付款单ID | - |
| DebtDetailId | Guid | 应付明细ID | - |
| PaymentAmount | decimal | 付款金额 | 50000.00 |
| PaymentNo | string | 付款流水号 | - |
| PaymentTime | DateTime? | 付款时间 | - |
| IsDeleted | bool | 是否删除 | false |

### 3.3 批量付款供应商表（PaymentAutoAgent）

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| Id | Guid | 主键 | 自动生成 |
| PaymentAutoItemId | Guid | 批量付款单ID | - |
| AgentId | Guid | 供应商ID | - |
| AgentName | string | 供应商名称 | 上海XX贸易有限公司 |
| AccountName | string | 银行账户名称 | 上海XX贸易有限公司 |
| AccountNo | string | 银行账号 | 6222020202020202 |
| BankName | string | 开户行名称 | 中国工商银行上海分行 |
| BankCode | string | 开户行编码 | ICBKSH01 |
| IsDeleted | bool | 是否删除 | false |

### 3.4 应付表（Debt）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| Id | Guid | 主键 |
| Code | string | 应付单号 |
| CompanyId | Guid | 公司ID |
| CompanyName | string | 公司名称 |
| CompanyCode | string | 公司编码 |
| DepartmentIdPath | string | 核算部门ID路径 |
| DepartmentNamePath | string | 核算部门名称路径 |
| DepartmentCurrentId | string | 核算部门当前ID |
| AgentId | Guid | 供应商ID |
| AgentName | string | 供应商名称 |
| DocumentType | string | 应付单据类型 |
| BusinessUnit | string | 业务单元 |
| Customer | string | 客户 |
| Currency | string | 币种 |
| PurchaseContractNo | string | 采购合同号 |
| ProjectName | string | 项目名称 |

### 3.5 应付明细表（DebtDetail）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| Id | Guid | 主键 |
| DebtId | Guid | 应付ID |
| SequenceNo | int | 序号 |
| PaymentTermType | string | 账期类型 |
| ExpectedPaymentDate | DateTime | 预计付款日期 |
| PaymentAmount | decimal | 付款金额 |
| PaidAmount | decimal | 已付金额 |
| RemainingAmount | decimal | 剩余金额 |

### 3.6 供应商表（Agent）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| Id | Guid | 供应商ID |
| Name | string | 供应商名称 |
| Code | string | 供应商Code |
| BankAccountName | string | 银行账号名称 |
| BankAccountNo | string | 银行账号 |
| BankName | string | 开户行名称 |
| BankCode | string | 开户行编码 |

## 四、业务规则

### 4.1 状态流转规则

```
待提交(0) → 审批中(1) → 已完成(2)
                ↓
            已驳回(11) → 待提交(0)
```

**状态说明**：
- **待提交(0)**：新创建的批量付款单，可以编辑、删除、提交
- **审批中(1)**：已提交审批，不可编辑、删除，等待审批结果
- **已完成(2)**：审批通过并完成付款，不可修改
- **已驳回(11)**：审批被驳回，可以重新编辑后再次提交

### 4.2 金额计算规则

1. **批量付款单总金额** = 所有明细的付款金额之和
2. **本次付款金额** ≤ 应付明细的剩余金额
3. **剩余金额** = 应付金额 - 已付金额

### 4.3 数据验证规则

**创建/编辑时验证**：
- 公司信息必填
- 至少包含一条付款明细
- 每条明细的付款金额必须大于0
- 付款金额不能超过应付明细的剩余金额
- 不能重复添加同一个应付明细

**提交时验证**：
- 必须包含至少一个供应商
- 供应商必须有完整的银行账号信息
- 所有明细的付款金额必须有效

### 4.4 权限控制规则

| 操作 | 待提交 | 审批中 | 已完成 | 已驳回 |
|------|--------|--------|--------|--------|
| 查看 | ✅ | ✅ | ✅ | ✅ |
| 编辑 | ✅ | ❌ | ❌ | ✅ |
| 删除 | ✅ | ❌ | ❌ | ❌ |
| 提交 | ✅ | ❌ | ❌ | ✅ |

## 五、UI交互说明

### 5.1 上下联动

- 选中上半部分列表中的批量付款单
- 下半部分自动显示该批量付款单的明细信息
- 包括付款明细和供应商信息

### 5.2 状态标签页切换

- 点击不同的状态标签页
- 自动筛选对应状态的批量付款单
- 显示该状态下的记录数量

### 5.3 实时汇总

- 在新增/编辑弹窗中
- 公司、核算部门通过下拉框选择
- 选中公司、核算部门后调用获取应付结果的接口，并在下方列表展示对应应付类型的数据
- 实时计算并显示：
  - 明细数量
  - 供应商数量
  - 总金额

### 5.4 金额格式化

- 所有金额字段右对齐
- 显示格式：千分位分隔，保留两位小数
- 示例：50,000.00

### 5.5 日期格式化

- 日期显示格式：YYYY-MM-DD
- 示例：2025-12-15

## 六、初始化数据要求

### 6.1 应付单据类型

系统需要初始化以下6种应付单据类型的测试数据：
1. 预付账期
2. 入库账期
3. 销售账期
4. 回款账期
5. 验收账期
6. 质保账期

### 6.2 数据量要求

- 每种单据类型初始化 5-20 条应付单（Debt）
- 每条应付单包含 1-3 条应付明细（DebtDetail）
- 初始化 2 个供应商（Agent）
- 供应商包含完整的银行账号信息

### 6.3 数据关联

- 应付单关联供应商
- 应付明细关联应付单
- 批量付款明细关联应付明细
- 批量付款供应商关联供应商
