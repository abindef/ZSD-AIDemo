
## 项目结构

###  解决方案结构

```
Finance/
├── src/
│   ├── Inno.CorePlatform.Finance.Domain/                 # 领域层（核心）
│   │   ├── Aggregates/                 # 聚合根
│   │   ├── ValueObjects/               # 值对象
│   │   ├── Events/                     # 领域事件
│   │   ├── Services/                   # 领域服务
│   │   ├── Repositories/               # 仓储接口
│   │   └── Exceptions/                 # 领域异常
│   │
│   ├── Inno.CorePlatform.Finance.Application/            # 应用层
│   │   ├── Commands/                   # 命令
│   │   ├── Queries/                    # 查询
│   │   ├── EventHandlers/              # 事件处理器
│   │   ├── Services/                   # 应用服务
│   │   └── DTOs/                       # 数据传输对象
│   │
│   ├── Inno.CorePlatform.Finance.Infrastructure/         # 基础设施层
│   │   ├── Persistence/                # 持久化
│   │   │   ├── Configurations/         # EF配置
│   │   │   └── Repositories/           # 仓储实现
│   │   ├── Adapters/                   # 外部适配器
│   │   │   ├── Kingdee/                # 金蝶集成
│   │   │   └── Dapr/                   # Dapr集成
│   │   └── Extensions/                 # 扩展方法
│   │
│   ├── Inno.CorePlatform.Finance.Backend/           # 后端宿主（内部调用）
│   │   ├── Controllers/
│   │   ├── Program.cs
│   │   └── appsettings.json
│   │
│   └── Inno.CorePlatform.Finance.WebApi/            # WebApi宿主（对外能力）
│       ├── Controllers/
│       ├── Program.cs
│       └── appsettings.json
│
├── tests/
│   ├── Inno.CorePlatform.Finance.Domain.Tests/           # 领域层测试
│   │   ├── Aggregates/
│   │   └── ValueObjects/
│   ├── Inno.CorePlatform.Finance.Application.Tests/      # 应用层测试
│   └── Inno.CorePlatform.Finance.Integration.Tests/      # 集成测试
│
└── docs/                               # 文档
    ├── bussiness/                      # 业务文档
    ├── roles/                          # 角色定义
    └── templates/                      # 模板
```

### 2.1 数据库配置（LocalDB 演示）

本项目演示环境默认使用 **SQL Server LocalDB**，便于本地快速启动与调试。

#### 连接字符串配置

在宿主层（`Inno.CorePlatform.Finance.Backend` / `Inno.CorePlatform.Finance.WebApi`）的 `appsettings.json` 中配置连接字符串：

```json
{
  "ConnectionStrings": {
    "Default": "Server=(localdb)\\MSSQLLocalDB;Database=Inno.CorePlatform.Finance;Trusted_Connection=True;MultipleActiveResultSets=true;TrustServerCertificate=True"
  }
}
```

说明：

- **Server**：`(localdb)\\MSSQLLocalDB` 为 LocalDB 默认实例。
- **Database**：可按需修改为你的演示库名。
- **Trusted_Connection=True**：使用 Windows 身份验证。

#### 初始化数据库（EF Core Migration）

通常迁移与更新数据库在 **Infrastructure** 项目中维护（`DbContext`/`Migrations` 所在项目），并以某个宿主项目作为启动项目（用于读取配置与 DI）。示例命令如下（从解决方案根目录执行）：

```powershell
dotnet tool update --global dotnet-ef
dotnet ef migrations add Init --project .\src\Inno.CorePlatform.Finance.Infrastructure --startup-project .\src\Inno.CorePlatform.Finance.WebApi
dotnet ef database update --project .\src\Inno.CorePlatform.Finance.Infrastructure --startup-project .\src\Inno.CorePlatform.Finance.WebApi
```

如果你实际启动的是 `Inno.CorePlatform.Finance.Backend`，则将 `--startup-project` 替换为对应宿主项目路径即可。

#### 前置要求

- 本机需安装 **SQL Server LocalDB**（通常随 Visual Studio / SQL Server Express 安装）。
- 若机器不支持 LocalDB，可将连接字符串切换为完整 SQL Server 实例（保持 `UseSqlServer` 配置不变）。

### 2.2 命名空间约定

```csharp
// 领域层
namespace Inno.CorePlatform.Finance.Domain.Aggregates.XXX;
namespace Inno.CorePlatform.Finance.Domain.ValueObjects;
namespace Inno.CorePlatform.Finance.Domain.Events;
namespace Inno.CorePlatform.Finance.Domain.Services;

// 应用层
namespace Inno.CorePlatform.Finance.Application.Commands.XXX;
namespace Inno.CorePlatform.Finance.Application.Queries.XXX;
namespace Inno.CorePlatform.Finance.Application.EventHandlers;

// 基础设施层
namespace Inno.CorePlatform.Finance.Infrastructure.Persistence;
namespace Inno.CorePlatform.Finance.Infrastructure.Adapters.Kingdee;

// 宿主层
namespace Inno.CorePlatform.Finance.Backend.Controllers;
namespace Inno.CorePlatform.Finance.WebApi.Controllers;
```

---
